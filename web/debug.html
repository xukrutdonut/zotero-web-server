<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Zotero</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Debug Zotero - Carga de Estructura</h1>
    
    <div class="debug-section">
        <h2>1. Test b√°sico API</h2>
        <button onclick="testBasicAPI()">Probar API</button>
        <div id="basicResult"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. Test simulaci√≥n cliente</h2>
        <button onclick="testClientSimulation()">Simular cliente</button>
        <div id="clientResult"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. Test DOM</h2>
        <div id="folderTree">Cargando...</div>
        <button onclick="testDOMSimulation()">Simular carga DOM</button>
        <div id="domResult"></div>
    </div>
    
    <script>
        // Test 1: API b√°sica
        async function testBasicAPI() {
            const resultDiv = document.getElementById('basicResult');
            try {
                const response = await fetch('/api/folder-tree');
                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="success">‚úÖ API OK</div>
                    <div class="info">Status: ${response.status}</div>
                    <div class="info">Tree elementos: ${data.tree ? data.tree.length : 'N/A'}</div>
                    <div class="info">Tiene error: ${data.error ? 'S√ç' : 'NO'}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Test 2: Simulaci√≥n exacta del cliente
        async function testClientSimulation() {
            const resultDiv = document.getElementById('clientResult');
            try {
                resultDiv.innerHTML = 'Cargando...';
                
                const response = await fetch('/api/folder-tree');
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                const tree = data.tree || [];
                
                resultDiv.innerHTML = `
                    <div class="success">‚úÖ Cliente simulaci√≥n OK</div>
                    <div class="info">Elementos procesados: ${tree.length}</div>
                    <div class="info">Primeros 3:</div>
                    <ul>${tree.slice(0, 3).map(item => `<li>${item.name} (${item.type})</li>`).join('')}</ul>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error en simulaci√≥n: ${error.message}</div>`;
            }
        }
        
        // Test 3: Simulaci√≥n DOM
        async function testDOMSimulation() {
            const resultDiv = document.getElementById('domResult');
            const folderTreeDiv = document.getElementById('folderTree');
            
            try {
                folderTreeDiv.innerHTML = 'Cargando estructura de carpetas...';
                
                const response = await fetch('/api/folder-tree');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                const tree = data.tree || [];
                
                // Renderizar simplificado
                if (tree.length === 0) {
                    folderTreeDiv.innerHTML = 'No hay documentos en la biblioteca';
                } else {
                    let html = '<ul>';
                    tree.slice(0, 10).forEach(item => {
                        html += `<li>üìÅ ${item.name} (${item.children ? item.children.length : 0} elementos)</li>`;
                    });
                    if (tree.length > 10) {
                        html += `<li>... y ${tree.length - 10} m√°s</li>`;
                    }
                    html += '</ul>';
                    folderTreeDiv.innerHTML = html;
                }
                
                resultDiv.innerHTML = `<div class="success">‚úÖ DOM actualizado correctamente</div>`;
                
            } catch (error) {
                folderTreeDiv.innerHTML = `Error: ${error.message}`;
                resultDiv.innerHTML = `<div class="error">‚ùå Error DOM: ${error.message}</div>`;
            }
        }
        
        // Auto-ejecutar test b√°sico al cargar
        document.addEventListener('DOMContentLoaded', testBasicAPI);
    </script>
</body>
</html>